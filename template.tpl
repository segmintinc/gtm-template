// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at

//     https://www.apache.org/licenses/LICENSE-2.0

// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "Segmint Marketing Platform",
  "categories": ['ANALYTICS','MARKETING','PERSONALIZATION'],
  "brand": {
    "id": "brand_dummy",
    "displayName": "",
    "thumbnail": "data:image/png;base64,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\u003d"
  },
  "description": "Segmint is a data analytics and marketing automation solution provider that helps financial institutions deliver one-to-one first-party data targeted messages to customers and website visitors.",
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "SELECT",
    "name": "environment",
    "displayName": "Environment",
    "macrosInSelect": false,
    "selectItems": [
      {
        "value": "prod",
        "displayValue": "Production"
      },
      {
        "value": "stage",
        "displayValue": "Stage"
      },
      {
        "value": "qa",
        "displayValue": "Quality Assurance"
      },
      {
        "value": "dev",
        "displayValue": "Development"
      }
    ],
    "simpleValueType": true
  },
  {
    "type": "TEXT",
    "name": "configId",
    "displayName": "Configuration ID",
    "simpleValueType": true
  },
  {
    "type": "CHECKBOX",
    "name": "debug",
    "checkboxText": "Enable debug logging",
    "simpleValueType": true
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

// Require the necessary GTM APIs
const logToConsole = require('logToConsole');
const injectScript = require('injectScript');
const setInWindow = require('setInWindow');
const queryPermission = require('queryPermission');

const segmintCdns = {
  dev: 'http://dev-media.segmint.net',
  qa: 'http://qa-media.segmint.net',
  stage: 'https://media2.segmint.net',
  prod: 'https://cdn.segmint.net'
};

// Get the URL the user input into the text field
const environment = data.environment;
const configId = data.configId;
const url = segmintCdns[environment]+'/gtm-invo-loader.js';

//sets global config id so it can be used by the second phase of the bootstrap
setInWindow('__sgmt_configId', configId, true);
setInWindow('__sgmt_cdnUrl', segmintCdns[environment], true);

// If the user chose to log debug output, initialize the logging method
const log = data.debug ? logToConsole : (() => {});

logToConsole('SGMT: Loading initial bootstrap from: ' + url);

// If the script loaded successfully, log a message and signal success
const onSuccess = () => {
  logToConsole('SGMT: Bootstrap successful.');
  data.gtmOnSuccess();
};

// If the script fails to load, log a message and signal failure
const onFailure = () => {
  logToConsole('SGMT: Bootstrap failed.');
  data.gtmOnFailure();
};

// If the URL input by the user matches the permissions set for the template,
// inject the script with the onSuccess and onFailure methods as callbacks.
if (queryPermission('inject_script', url)) {
  injectScript(url, onSuccess, onFailure);
} else {
  logToConsole('SGMT: Bootstrap failed due to GTM permission mismatch.');
  data.gtmOnFailure();
}


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "all"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_globals",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "__sgmt_configId"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "__sgmt_cdnUrl"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "inject_script",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://*.segmint.net/"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios: []


___NOTES___

Created on 6/16/2021, 10:16:00 AM
